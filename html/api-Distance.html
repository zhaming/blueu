<!DOCTYPE html>
<html lang="en" style="" class=" js flexbox flexboxlegacy canvas canvastext webgl no-touch geolocation postmessage websqldatabase indexeddb hashchange history draganddrop websockets rgba hsla multiplebgs backgroundsize borderimage borderradius boxshadow textshadow opacity cssanimations csscolumns cssgradients cssreflections csstransforms no-csstransforms3d csstransitions fontface generatedcontent video audio localstorage sessionstorage webworkers applicationcache svg inlinesvg smil svgclippaths"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">

    <meta charset="utf-8">

    <!-- STYLESHEETS -->
    <link href="/statics/blueu/styles/bootstrap.css" rel="stylesheet">
    <link href="/statics/blueu/styles/fonts.css" rel="stylesheet">
    <link href="/statics/blueu/styles/api_style.css" rel="stylesheet">
    <link href="/statics/blueu/styles/prism.css" rel="stylesheet">

    <!-- JAVASCRIPT -->
    <script type="text/javascript" async="" src="/statics/blueu/js/ga.js"></script>
    <script type="text/javascript" src="/statics/blueu/js/jquery.min.js"></script>
    <script type="text/javascript" src="/statics/blueu/js/modernizr-latest.js"></script>
    <script type="text/javascript" src="/statics/blueu/js/bootstrap.js"></script>

  </head>

  <body id="tutorials" class="api" style="">
    <div id="wrapper">

      <header id="nav" class="navbar" role="navigation">
        <div id="branding" class="pull-left"><a href="http://estimote.com/api/" title="Real world context for your apps">Estimote Beacons</a></div>
        <div class="container">
            <ul class="nav navbar-nav text-center">
               <li><a href="/html/home.html"  >首页</a></li>
              <li><a href="/html/for-retail.html"  >零售</a></li>
              <li><a href="/html/api.html" class="active">Api</a></li>
              <!-- <li><a href="/html/community.html" >社区</a></li> -->
              <li><a href="/html/contact_us.html"  >联系我们</a></li>
              <li><a href="/html/join_us.html" >加入我们</a></li>
            </ul>
        </div>

      </header> <!-- #nav -->
      <header id="nav-small" class"navbar"="" role="navigation" style="display: none;">
        <div class="container">
          <div class="col-md-2 col-md-offset-1">
            <div class="branding"></div>
          </div>
          <div class="col-md-9">
            <h2>如何重新创建该应用程序的距离</h2>
          </div>
        </div>
      </header>

      <section id="breadcrumb" class="jumbotron">
        <div class="container">
          <div class="col-md-11 col-md-offset-1">
            <h1>如何重新创建该应用程序的距离</h1>
          </div>
        </div>
      </section> <!-- #breadcrumb -->

      <section id="api" class="row">
        <div class="container">
          <div class="col-md-2 col-md-offset-1">
            <div id="sticky-anchor"></div>
            <ul class="nav nav-pills nav-stacked">
              <li><a href="/html/about.html">关于我们</a></li>
              <li><a href="/html/for-retail.html">零售应用</a></li>
              <li><a href="#">API文档</a></li>
                <li class="submenu"><a href="#" >入门</a></li>
                <li class="submenu"><a href="/html/api-Tutorials.html">教程</a></li>
                  <li class="submenu-2"><a href="/html/api-Distance.html"  class="active">距离</a></li>
                  <li class="submenu-2"><a href="/html/api-Proximity.html">接近</a></li>
                  <li class="submenu-2"><a href="/html/api-Notification.html">通知</a></li>
               <li class="submenu"><a href="#">iOS的SDK</a></li>
                <li class="submenu"><a href="#">Android 的 SDK</a></li>
                <li class="submenu"><a href="#">API参考</a></li>
            </ul>
          </div>
          <div class="col-md-8 content">
            <h2>介绍</h2>
              <p>
                远处的应用程序是一个简单的Estimote演示应用程序尚未也是最有效的方法之一，了解其功能在于在所有其他的事情你可以用Estimote信标做的非常核心的。
                </p>
            <div class="row screens">
              <div class="col-md-4">
                <img src="/statics/blueu/images/distance1.png" class="img-responsive" alt="">
              </div>
              <div class="col-md-4">
                <img src="/statics/blueu/images/distance2.png" class="img-responsive" alt="">
              </div>
              <div class="col-md-4">
                <img src="/statics/blueu/images/distance3.png" class="img-responsive" alt="">
              </div>
            </div>
            <h2>它是如何工作的</h2>
              <p>
                这个程序的措施和可视化用户的位置和信标之间的距离。 这些信息可以被用来再比如告诉，如果该人是越来越接近信标，搬走，或者如果他们已经停止，并建立相关的上下文的人所在的事件</p>
              <p>
                它的工作方式是非常简单 - 一盏明灯广播其ID和信号的强度，或RSSI（接收信号强度指示），正在不断通过手机监控。 基于信号强度和校准数据，可以推断出如何远离手机是从信标。
              </p>
            <h2>消除干扰</h2>
              <p>
                由于可能的干扰的采样的方式，将筛选出突然的尖峰和凹陷，这会影响到读出的信号强度，这是很重要的。 这是通过使用滚动平均值，并考虑到多个读数，不只是一个做。 这稳定了距离的值，在响应的轻微的退化为代价的。
                 </p>
            <h2>显示搜索结果的用户界面</h2>
              <p>
               在用户界面中，周围的信标中的区域被分成三个“区”：“直接”，“近”和“远”。 这些区域未在本演示中使用，但在其他演示应用程序使用。 然而，在这个演示条纹“超出范围”区域中使用，因为用户会被要求离开尽可能直到他们完全失去信号。 出于实际原因虽然，“信号丢失”的消息显示相当早一点，免得用户走不了足够远，真正失去了信号   </p>
            <h2>该怎么办呢</h2>
<p>重建的距离的演示是很简单的。 让我们通过这个演示应用程序的一些关键要素。</p>
<p>首先，请确保您添加的CoreBluetooth.framework和CoreLocation.framework到您的项目，以及libEstimoteSDK7.a，它包含在演示项目。</p>

              <pre class=" line-numbers language-clike"><code class=" language-clike">
<span class="token operator">-</span> <span class="token punctuation">(</span>void<span class="token punctuation">)</span>viewDidLoad
<span class="token punctuation">{</span>
    <span class="token punctuation">[</span>super viewDidLoad<span class="token punctuation">]</span><span class="token punctuation">;</span>

   <span class="token comment" spellcheck="true"> /////////////////////////////////////////////////////////////
</span>   <span class="token comment" spellcheck="true"> // setup Estimote beacon manager
</span>
   <span class="token comment" spellcheck="true"> // create manager instance
</span>    self<span class="token punctuation">.</span>beaconManager <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">[</span>ESTBeaconManager alloc<span class="token punctuation">]</span> init<span class="token punctuation">]</span><span class="token punctuation">;</span>
    self<span class="token punctuation">.</span>beaconManager<span class="token punctuation">.</span>delegate <span class="token operator">=</span> self<span class="token punctuation">;</span>
    self<span class="token punctuation">.</span>beaconManager<span class="token punctuation">.</span>avoidUnknownStateBeacons <span class="token operator">=</span> YES<span class="token punctuation">;</span>

   <span class="token comment" spellcheck="true"> // create sample region object (you can additionaly pass major / minor values)
</span>    ESTBeaconRegion<span class="token operator">*</span> region <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">[</span>ESTBeaconRegion alloc<span class="token punctuation">]</span> initRegionWithIdentifier<span class="token punctuation">:</span>@<span class="token string">"EstimoteSampleRegion"</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

   <span class="token comment" spellcheck="true"> // start looking for estimtoe beacons in region
</span>   <span class="token comment" spellcheck="true"> // when beacon ranged beaconManager:didRangeBeacons:inRegion: invoked
</span>    <span class="token punctuation">[</span>self<span class="token punctuation">.</span>beaconManager startRangingBeaconsInRegion<span class="token punctuation">:</span>region<span class="token punctuation">]</span><span class="token punctuation">;</span>


   <span class="token comment" spellcheck="true"> /////////////////////////////////////////////////////////////
</span>   <span class="token comment" spellcheck="true"> // setup Estimote beacon manager
</span>
    <span class="token punctuation">[</span>self setupView<span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code>
              </pre>

              <p class="tut">
                第一步是使用 <span class="syntax italic">ESTBeaconManager</span> 类来创建Estimote灯塔管理器对象并设置委托对象。在这个例子中，我们使用的是<span class="syntax italic">avoidUnknownStateBeacons</span> 标志。 核心定位框架在从发现航标列表对象去除一些惯性。 这个管理器属性设置为YES允许我们强制删除列表中的所有未知状态的对象。 我们还调用<span class="syntax italic">startRangingBeaconsInRegion:</span> 方法来开始寻找那些与基本<span class="syntax italic">ESTBeaconRegion</span>对象所描述的Estimote信标。</p>

              <pre class=" line-numbers language-clike"><code class=" language-clike">
<span class="token operator">-</span><span class="token punctuation">(</span>void<span class="token punctuation">)</span>setupView
<span class="token punctuation">{</span>
   <span class="token comment" spellcheck="true"> /////////////////////////////////////////////////////////////
</span>   <span class="token comment" spellcheck="true"> // setup background image
</span>
    CGRect          screenRect          <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">[</span>UIScreen mainScreen<span class="token punctuation">]</span> bounds<span class="token punctuation">]</span><span class="token punctuation">;</span>
    CGFloat         screenHeight        <span class="token operator">=</span> screenRect<span class="token punctuation">.</span>size<span class="token punctuation">.</span>height<span class="token punctuation">;</span>
    UIImageView<span class="token operator">*</span>    backgroundImage<span class="token punctuation">;</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span>screenHeight <span class="token operator">&gt;</span> <span class="token number">480</span><span class="token punctuation">)</span>
        backgroundImage <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">[</span>UIImageView alloc<span class="token punctuation">]</span> initWithImage<span class="token punctuation">:</span><span class="token punctuation">[</span>UIImage imageNamed<span class="token punctuation">:</span>@<span class="token string">"backgroundBig"</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token keyword">else</span>
        backgroundImage <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">[</span>UIImageView alloc<span class="token punctuation">]</span> initWithImage<span class="token punctuation">:</span><span class="token punctuation">[</span>UIImage imageNamed<span class="token punctuation">:</span>@<span class="token string">"backgroundSmall"</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

    <span class="token punctuation">[</span>self<span class="token punctuation">.</span>view addSubview<span class="token punctuation">:</span>backgroundImage<span class="token punctuation">]</span><span class="token punctuation">;</span>

   <span class="token comment" spellcheck="true"> /////////////////////////////////////////////////////////////
</span>   <span class="token comment" spellcheck="true"> // setup dot image
</span>
    self<span class="token punctuation">.</span>positionDot <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">[</span>UIImageView alloc<span class="token punctuation">]</span> initWithImage<span class="token punctuation">:</span><span class="token punctuation">[</span>UIImage imageNamed<span class="token punctuation">:</span>@<span class="token string">"dotImage"</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token punctuation">[</span>self<span class="token punctuation">.</span>positionDot setCenter<span class="token punctuation">:</span>self<span class="token punctuation">.</span>view<span class="token punctuation">.</span>center<span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token punctuation">[</span>self<span class="token punctuation">.</span>positionDot setAlpha<span class="token punctuation">:</span><span class="token number">1</span><span class="token punctuation">.</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

    <span class="token punctuation">[</span>self<span class="token punctuation">.</span>view addSubview<span class="token punctuation">:</span>self<span class="token punctuation">.</span>positionDot<span class="token punctuation">]</span><span class="token punctuation">;</span>

    self<span class="token punctuation">.</span>dotMinPos <span class="token operator">=</span> <span class="token number">150</span><span class="token punctuation">;</span>
    self<span class="token punctuation">.</span>dotRange <span class="token operator">=</span> self<span class="token punctuation">.</span>view<span class="token punctuation">.</span>bounds<span class="token punctuation">.</span>size<span class="token punctuation">.</span>height  <span class="token operator">-</span> <span class="token number">220</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code>
              </pre>

              <p class="tut">在里面setupView函数中，我们定义背景图片，以及网点图像，这表明从手机iBeacon距离。</p>

              <pre class=" line-numbers language-clike"><code class=" language-clike">
<span class="token operator">-</span><span class="token punctuation">(</span>void<span class="token punctuation">)</span>beaconManager<span class="token punctuation">:</span><span class="token punctuation">(</span>ESTBeaconManager <span class="token operator">*</span><span class="token punctuation">)</span>manager
     didRangeBeacons<span class="token punctuation">:</span><span class="token punctuation">(</span>NSArray <span class="token operator">*</span><span class="token punctuation">)</span>beacons
            inRegion<span class="token punctuation">:</span><span class="token punctuation">(</span>ESTBeaconRegion <span class="token operator">*</span><span class="token punctuation">)</span>region
<span class="token punctuation">{</span>
    ESTBeacon<span class="token operator">*</span> closestBeacon<span class="token punctuation">;</span>

    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token punctuation">[</span>beacons count<span class="token punctuation">]</span> <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
       <span class="token comment" spellcheck="true"> // beacon array is sorted based on distance
</span>       <span class="token comment" spellcheck="true"> // closest beacon is the first one
</span>        closestBeacon <span class="token operator">=</span> <span class="token punctuation">[</span>beacons objectAtIndex<span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

       <span class="token comment" spellcheck="true"> // calculate and set new y position
</span>        float newYPos <span class="token operator">=</span> self<span class="token punctuation">.</span>dotMinPos <span class="token operator">+</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>float<span class="token punctuation">)</span>closestBeacon<span class="token punctuation">.</span>ibeacon<span class="token punctuation">.</span>rssi <span class="token operator">/</span> <span class="token operator">-</span><span class="token number">100</span><span class="token punctuation">.</span><span class="token punctuation">)</span> <span class="token operator">*</span> self<span class="token punctuation">.</span>dotRange<span class="token punctuation">;</span>
        self<span class="token punctuation">.</span>positionDot<span class="token punctuation">.</span>center <span class="token operator">=</span> <span class="token function">CGPointMake<span class="token punctuation">(</span></span>self<span class="token punctuation">.</span>view<span class="token punctuation">.</span>bounds<span class="token punctuation">.</span>size<span class="token punctuation">.</span>width <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">,</span> newYPos<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code>
            </pre>

            <p class="tut">当我们的UI和 <span class="syntax italic">BeaconManager</span> 到位最后要做的就是处理发现的信标。 我们使用<span class="syntax italic">beaconManager:didRangeBeacons:inRegion:</span>委托方法来做到这一点。 返回信标名单是根据距离来分类的（最近的灯塔是第一次就行了）。 我们得到了利用指数0最近 <span class="syntax italic">ESTBeacon</span> 对象。 每一个<span class="syntax italic">ESTBeacon</span> 对象包含参照CoreLocation框架返回原<span class="syntax italic">CLBeacon</span> 对象。 我们使用它来获取当前RSSI值，并根据它我们更新点位置。 RSSI可以在范围改变从-100到0（其中0表示信标是最接近设备）。</p>




              <p>
                您可以从GitHub上下载完整的项目
              </p>

              <a href="https://github.com/Estimote/iOS-SDK" class="btn btn-primary btn-lg btn-api">下载源代码</a>
            <div class="row apps">
              <!-- <div class="col-md-4 apps-tut">
                <img src="../images/icon1.png" alt="">
                <h3><a href="tutorials/distance.html">Distance demo app</a></h3>
                <p>Visualize the distance between a beacon and a phone</p>
              </div> -->
              <div class="col-md-4 apps-tut">
                <img src="/statics/blueu/images/icon2.png" alt="">
                <h3><a href="#">感应演示应用程序</a></h3>
                <p>显示在交叉区域的消息</p>
              </div>
              <div class="col-md-4 apps-tut">
                <img src="/statics/blueu/images/icon3.png" alt="">
                <h3><a href="#">通知演示应用程序</a></h3>
                <p>在离开一个区域发送推送通知</p>
              </div>
            </div>
          </div>
        </div>
      </section> <!-- #api -->

      <object type="text/x-scriptlet" width="100%" height="333px"  data="footer.html"></object>
      <!-- #footer -->

    </div> <!-- #wrapper -->

  <!-- sticky sidebar navigation -->
  <script type="text/javascript">
    function sticky_relocate() {
      var window_top = $(window).scrollTop();
      var div_top = $('#sticky-anchor').offset().top;

      if (window_top > div_top) {
          $('#api .nav').addClass('stick');
      } else {
          $('#api .nav').removeClass('stick');
      }
    }

    $(function () {
        $(window).scroll(sticky_relocate);
        sticky_relocate();
    });
  </script>

</body></html>